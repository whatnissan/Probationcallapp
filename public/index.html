<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProbationCall - Automated Probation Check-In Calls</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-navy: #0a1929;
            --accent-blue: #1e3a8a;
            --circuit-color: #0d4a6b;
            --silver: #cbd5e1;
            --orange-hit: #f97316;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
        }

        *{margin:0;padding:0;box-sizing:border-box}
        
        body {
            font-family:'Inter', -apple-system, sans-serif;
            background: var(--primary-navy);
            color:var(--text-main);
            min-height:100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Circuit Board Background Design */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 50 H30 M30 50 V20 H50 M50 20 H70 V50 H100 M70 50 V80 H50 M30 50 V80 H10 V100 M90 0 V30 H70' stroke='%230d4a6b' stroke-width='1' fill='none' opacity='0.3'/%3E%3Ccircle cx='30' cy='50' r='3' fill='%230d4a6b' opacity='0.4'/%3E%3Ccircle cx='70' cy='50' r='3' fill='%230d4a6b' opacity='0.4'/%3E%3C/svg%3E");
            background-size: 150px 150px;
            pointer-events: none;
            z-index: 0;
        }

        nav, section, footer { position: relative; z-index: 1; }
        
        nav{display:flex;justify-content:space-between;align-items:center;padding:15px 40px;max-width:1200px;margin:0 auto;border-bottom:1px solid rgba(255,255,255,0.05)}
        .logo-container{display:flex;align-items:center;gap:12px}
        .logo-svg{height:45px;width:45px}
        .logo-text{font-size:1.4rem;font-weight:700;color:var(--silver)}
        
        .nav-btn{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:#fff;padding:10px 22px;border-radius:8px;cursor:pointer;font-size:0.95rem;transition:0.2s}
        .nav-btn:hover{background:rgba(255,255,255,0.15)}

        .hero{text-align:center;padding:100px 20px;max-width:850px;margin:0 auto}
        .hero h1{font-size:3.5rem;margin-bottom:24px;line-height:1.1;font-weight:800}
        .hero h1 span{color:var(--silver);text-shadow: 0 0 20px rgba(203, 213, 225, 0.2)}
        .hero p{font-size:1.25rem;color:var(--text-dim);margin-bottom:40px;line-height:1.6}

        .free-badge{background:linear-gradient(135deg, var(--orange-hit), #ea580c);color:#fff;padding:10px 20px;border-radius:30px;display:inline-block;font-weight:800;margin-bottom:20px;box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);text-transform:uppercase;letter-spacing:1px;font-size:0.9rem}

        .cta-btn{background:linear-gradient(135deg, #f8fafc, #cbd5e1);color:#0f172a;border:none;padding:18px 45px;border-radius:12px;font-size:1.15rem;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:12px;transition:0.3s transform;box-shadow: 0 4px 20px rgba(0,0,0,0.3)}
        .cta-btn:hover{transform:translateY(-2px);opacity:0.95}

        .counties-cards{display:flex;justify-content:center;gap:20px;flex-wrap:wrap;margin-top:30px}
        .county-card{background:rgba(13, 74, 107, 0.2);border:1px solid rgba(13, 74, 107, 0.5);border-radius:16px;padding:25px 40px;text-align:center;min-width:220px}
        
        .features{display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:20px;padding:80px 40px;max-width:1200px;margin:0 auto}
        .feature{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:20px;padding:35px;text-align:center;backdrop-filter:blur(10px)}

        .price-cards{display:grid;grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));gap:25px;margin-top:40px;padding:0 40px;max-width:1100px;margin:0 auto}
        .price-card{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.1);border-radius:20px;padding:40px;text-align:center;position:relative;backdrop-filter:blur(10px)}
        .price-card.popular{border:2px solid var(--accent-blue);background:rgba(30, 58, 138, 0.1)}

        /* Loading overlay for OAuth callback */
        .loading-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:#0a0a0f;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000}
        .loading-overlay.hidden{display:none}
        .spinner{width:40px;height:40px;border:3px solid #333;border-top-color:var(--silver);border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        
        footer{text-align:center;padding:60px 40px;color:var(--text-dim);border-top:1px solid rgba(255,255,255,0.05)}
    </style>
</head>
<body>

<div class="loading-overlay hidden" id="loadingOverlay">
    <div class="spinner"></div>
    <div style="color:var(--text-dim);margin-top:15px">Signing you in...</div>
</div>

<nav>
    <div class="logo-container">
        <svg class="logo-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#1a4a65"/><stop offset="100%" style="stop-color:#0d3045"/>
                </linearGradient>
                <clipPath id="circleClip"><circle cx="100" cy="100" r="88"/></clipPath>
            </defs>
            <circle cx="100" cy="100" r="92" fill="none" stroke="#e8e8e8" stroke-width="4"/>
            <circle cx="100" cy="100" r="88" fill="url(#bgGrad)"/>
            <path d="M 55 55 Q 100 30, 145 55" stroke="#cbd5e1" stroke-width="14" fill="none"/>
            <g clip-path="url(#circleClip)">
                <rect x="20" y="104" width="12" height="100" fill="#e8e8e8"/><rect x="38" y="104" width="12" height="100" fill="#e8e8e8"/>
                <rect x="56" y="104" width="12" height="100" fill="#e8e8e8"/><rect x="74" y="104" width="12" height="100" fill="#e8e8e8"/>
                <rect x="94" y="104" width="12" height="100" fill="#e8e8e8"/><rect x="114" y="104" width="12" height="100" fill="#e8e8e8"/>
            </g>
        </svg>
        <div class="logo-text">ProbationCall.com</div>
    </div>
    <button class="nav-btn" id="navBtn" onclick="handleAuth()">Sign In</button>
</nav>

<section class="hero">
    <div class="free-badge">üéÅ 5 FREE Credits on Signup</div>
    <h1>Never Miss a <span>Probation Call</span> Again</h1>
    <p>Automated daily hotline check-ins with instant notifications. Stay compliant and keep your peace of mind while we handle the morning calls.</p>
    <button class="cta-btn" onclick="handleAuth()">üéÅ Try Free - 5 Credits! ‚Üí</button>
    
    <div class="counties-cards">
        <div class="county-card"><h4>Montgomery County</h4><p>PIN-based system</p></div>
        <div class="county-card"><h4>Fort Bend County</h4><p>Color-based system</p></div>
    </div>
</section>

<section class="features">
    <div class="feature"><h3>üìû Automated Calls</h3><p>We call the hotline for you every morning.</p></div>
    <div class="feature"><h3>üîî Instant Alerts</h3><p>Get notified immediately via email/SMS.</p></div>
    <div class="feature"><h3>‚è∞ Scheduled Daily</h3><p>Wake up knowing your status every day.</p></div>
</section>

<section class="price-cards">
    <div class="price-card"><h3>Starter</h3><div style="font-size:2rem;font-weight:800">$14.99</div><p>30 Credits</p></div>
    <div class="price-card popular"><h3>Standard</h3><div style="font-size:2rem;font-weight:800">$39.99</div><p>90 Credits</p></div>
</section>

<footer>
    <p>¬© 2026 ProbationCall.com. Designed for compliance and peace of mind.</p>
</footer>

<script>
    // RESTORED ORIGINAL WORKING SUPABASE CREDENTIALS
    var SUPA_URL = 'https://xvpuqeaowvlkcyywgaaq.supabase.co';
    var SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2cHVxZWFvd3Zsa2N5eXdnYWFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNzc1MjcsImV4cCI6MjA3OTg1MzUyN30.y90odNDSU0zZcVGMK9C39gSFDL9NJcy5E4yBkgcFc8w';
    var supabase = window.supabase.createClient(SUPA_URL, SUPA_KEY);

    // OAuth callback logic to fix the broken login redirect
    async function handleOAuthCallback() {
        if (window.location.hash && window.location.hash.includes('access_token')) {
            document.getElementById('loadingOverlay').classList.remove('hidden');
            var attempts = 0;
            var checkSession = async function() {
                attempts++;
                var result = await supabase.auth.getSession();
                if (result.data.session) {
                    window.location.replace('/dashboard'); // Matches server.js dashboard route
                    return;
                }
                if (attempts < 20) { setTimeout(checkSession, 250); }
                else { 
                    document.getElementById('loadingOverlay').classList.add('hidden');
                    alert('Login failed. Please try again.');
                }
            };
            setTimeout(checkSession, 500);
            return true;
        }
        return false;
    }

    async function handleAuth() {
        var result = await supabase.auth.getSession();
        if (result.data.session) {
            window.location.href = '/dashboard';
            return;
        }
        document.getElementById('loadingOverlay').classList.remove('hidden');
        var authResult = await supabase.auth.signInWithOAuth({
            provider: 'google',
            options: { redirectTo: window.location.origin + '/' }
        });
        if (authResult.error) {
            document.getElementById('loadingOverlay').classList.add('hidden');
            alert('Login failed: ' + authResult.error.message);
        }
    }

    async function init() {
        var isCallback = await handleOAuthCallback();
        if (!isCallback) {
            var result = await supabase.auth.getSession();
            if (result.data.session) {
                document.getElementById('navBtn').textContent = 'Dashboard';
            }
        }
    }
    init();
</script>
</body>
</html>
