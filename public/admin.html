<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - ProbationCall</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,sans-serif;background:#0a0a0f;color:#fff;min-height:100vh}.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;gap:15px}.spinner{width:40px;height:40px;border:3px solid #333;border-top-color:#ef4444;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.container{max-width:1400px;margin:0 auto;padding:20px;display:none}nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid rgba(255,255,255,0.1)}.logo{font-size:1.3rem;font-weight:700;color:#ef4444}.nav-right{display:flex;align-items:center;gap:10px}.admin-badge{background:#ef4444;color:#fff;padding:4px 10px;border-radius:4px;font-size:0.75rem;font-weight:700}.back-btn{background:rgba(255,255,255,0.1);border:none;color:#fff;padding:8px 14px;border-radius:6px;cursor:pointer;text-decoration:none}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:25px}.stat-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:18px;text-align:center}.stat-num{font-size:1.8rem;font-weight:700;color:#00d9ff}.stat-label{color:#8892b0;font-size:0.8rem;margin-top:5px}.stat-card.green .stat-num{color:#22c55e}.stat-card.orange .stat-num{color:#f59e0b}.stat-card.red .stat-num{color:#ef4444}.stat-card.purple .stat-num{color:#a78bfa}.tabs{display:flex;gap:8px;margin-bottom:15px;flex-wrap:wrap}.tab{padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#8892b0;cursor:pointer}.tab.active{background:#ef4444;color:#fff;border-color:#ef4444}.tab-content{display:none}.tab-content.active{display:block}.card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:20px;margin-bottom:15px}.card h2{color:#00d9ff;margin-bottom:15px;font-size:1.1rem}table{width:100%;border-collapse:collapse;font-size:0.85rem}th,td{padding:10px 8px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.05)}th{color:#8892b0;font-weight:600;font-size:0.75rem;text-transform:uppercase}tr.clickable{cursor:pointer}tr.clickable:hover{background:rgba(0,217,255,0.1)}.badge{padding:3px 8px;border-radius:12px;font-size:0.7rem;font-weight:600;display:inline-block}.badge.active{background:rgba(34,197,94,0.2);color:#22c55e}.badge.disabled{background:rgba(239,68,68,0.2);color:#ef4444}.badge.pending{background:rgba(245,158,11,0.2);color:#f59e0b}.badge.admin{background:rgba(139,92,246,0.2);color:#a78bfa}.badge.yes{background:rgba(34,197,94,0.2);color:#22c55e}.badge.no{background:rgba(239,68,68,0.2);color:#ef4444}.btn{padding:6px 12px;border-radius:6px;border:none;cursor:pointer;font-size:0.75rem;font-weight:600}.btn-sm{padding:4px 8px;font-size:0.7rem}.btn-primary{background:#00d9ff;color:#000}.btn-danger{background:#ef4444;color:#fff}.btn-success{background:#22c55e;color:#000}.btn-warning{background:#f59e0b;color:#000}.btn-secondary{background:rgba(255,255,255,0.1);color:#fff}.btn-purple{background:#a78bfa;color:#000}.search-bar{display:flex;gap:10px;margin-bottom:15px}.search-bar input,.search-bar select{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:#fff}.search-bar input{flex:1}.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);display:none;align-items:center;justify-content:center;z-index:100;padding:20px;overflow-y:auto}.modal.active{display:flex}.modal-content{background:#1a1a2e;border-radius:16px;padding:25px;max-width:900px;width:100%;max-height:90vh;overflow-y:auto}.modal-close{float:right;background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer}.form-group{margin-bottom:15px}.form-group label{display:block;margin-bottom:5px;color:#8892b0}.form-group input,.form-group select{width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:#fff}.detail-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}.detail-item{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:8px;padding:12px}.detail-label{color:#8892b0;font-size:0.75rem;text-transform:uppercase;margin-bottom:4px}.detail-value{color:#fff;font-size:1rem;font-weight:600}.payout-card{background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:12px;padding:15px;margin-bottom:10px}.payout-amount{font-size:1.4rem;font-weight:700;color:#f59e0b}.access-denied{text-align:center;padding:100px 20px}.access-denied h1{color:#ef4444}.text-muted{color:#666}.text-green{color:#22c55e}.text-cyan{color:#00d9ff}.text-orange{color:#f59e0b}.mono{font-family:monospace}.section-title{color:#00d9ff;font-size:1rem;margin:20px 0 10px;padding-bottom:5px;border-bottom:1px solid rgba(255,255,255,0.1)}</style>
</head>
<body>
<div class="loading" id="loading"><div class="spinner"></div><div style="color:#8892b0">Loading Admin...</div></div>
<div class="access-denied" id="accessDenied" style="display:none"><h1>Access Denied</h1><p style="color:#8892b0">Not an admin.</p><a href="/dashboard" class="btn btn-primary">Back</a></div>
<div class="container" id="app">
<nav><div class="logo">Admin Panel</div><div class="nav-right"><span class="admin-badge">ADMIN</span><span id="userEmail" style="color:#8892b0;font-size:0.85rem"></span><a href="/dashboard" class="back-btn">Dashboard</a></div></nav>
<div class="stats-grid"><div class="stat-card"><div class="stat-num" id="statUsers">0</div><div class="stat-label">Total Users</div></div><div class="stat-card green"><div class="stat-num" id="statActive">0</div><div class="stat-label">Active Schedules</div></div><div class="stat-card"><div class="stat-num" id="statCalls">0</div><div class="stat-label">Total Calls</div></div><div class="stat-card green"><div class="stat-num" id="statRevenue">$0</div><div class="stat-label">Revenue</div></div><div class="stat-card orange"><div class="stat-num" id="statPending">0</div><div class="stat-label">Pending Payouts</div></div><div class="stat-card orange"><div class="stat-num" id="statOwed">$0</div><div class="stat-label">Affiliate Owed</div></div><div class="stat-card purple"><div class="stat-num" id="statTerms">0</div><div class="stat-label">Terms Agreed</div></div><div class="stat-card red"><div class="stat-num" id="statDisabled">0</div><div class="stat-label">Disabled</div></div></div>
<div class="tabs"><div class="tab active" id="tabUsers">Users</div><div class="tab" id="tabPayouts">Payouts</div><div class="tab" id="tabPurchases">Purchases</div><div class="tab" id="tabCalls">Calls</div><div class="tab" id="tabPromos">Promos</div></div>
<div id="usersTab" class="tab-content active"><div class="card"><h2>All Users (click to view) <button class="btn btn-sm btn-secondary" id="refreshBtn">Refresh</button></h2><div class="search-bar"><input type="text" id="userSearch" placeholder="Search..."><select id="userFilter"><option value="all">All</option><option value="active">Active</option><option value="disabled">Disabled</option><option value="admin">Admins</option><option value="scheduled">Scheduled</option></select></div><div style="max-height:500px;overflow-y:auto"><table><thead><tr><th>Email</th><th>Credits</th><th>Schedule</th><th>Calls</th><th>Spent</th><th>Terms</th><th>Status</th><th>Last Login</th></tr></thead><tbody id="usersTable"></tbody></table></div></div></div>
<div id="payoutsTab" class="tab-content"><div class="card"><h2>Pending Payouts</h2><div id="pendingPayouts"></div></div></div>
<div id="purchasesTab" class="tab-content"><div class="card"><h2>Purchases</h2><table><thead><tr><th>User</th><th>Package</th><th>Amount</th><th>Date</th></tr></thead><tbody id="purchasesTable"></tbody></table></div></div>
<div id="callsTab" class="tab-content"><div class="card"><h2>Calls</h2><table><thead><tr><th>User</th><th>Result</th><th>Date</th></tr></thead><tbody id="callsTable"></tbody></table></div></div>
<div id="promosTab" class="tab-content"><div class="card"><h2>Promos <button class="btn btn-sm btn-primary" id="newPromoBtn">+ New</button></h2><table><thead><tr><th>Code</th><th>Credits</th><th>Used/Max</th><th>Actions</th></tr></thead><tbody id="promosTable"></tbody></table></div></div>
</div>
<div class="modal" id="userModal"><div class="modal-content"><button class="modal-close" id="closeUserModal">x</button><h2 style="color:#00d9ff" id="userModalTitle">User</h2><div id="userModalContent"></div></div></div>
<div class="modal" id="creditsModal"><div class="modal-content" style="max-width:400px"><button class="modal-close" id="closeCreditsModal">x</button><h2>Manage Credits</h2><p style="color:#8892b0;margin:15px 0">User: <span id="creditsEmail" style="color:#fff"></span><br>Current: <span id="creditsCurrent" style="color:#00d9ff"></span></p><input type="hidden" id="creditsUid"><div class="form-group"><label>Action</label><select id="creditsAction"><option value="add">Add</option><option value="remove">Remove</option><option value="set">Set To</option></select></div><div class="form-group"><label>Amount</label><input type="number" id="creditsAmount" value="10" min="0"></div><button class="btn btn-success" style="width:100%;padding:12px" id="applyCredits">Apply</button></div></div>
<div class="modal" id="promoModal"><div class="modal-content" style="max-width:400px"><button class="modal-close" id="closePromoModal">x</button><h2>New Promo</h2><div class="form-group"><label>Code</label><input type="text" id="promoCode" style="text-transform:uppercase"></div><div class="form-group"><label>Credits</label><input type="number" id="promoCredits" value="5" min="1"></div><div class="form-group"><label>Max Uses</label><input type="number" id="promoMax" value="100" min="1"></div><button class="btn btn-primary" style="width:100%;padding:12px" id="createPromo">Create</button></div></div>
<script>
var SUPA_URL="https://xvpuqeaowvlkcyywgaaq.supabase.co",SUPA_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2cHVxZWFvd3Zsa2N5eXdnYWFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNzc1MjcsImV4cCI6MjA3OTg1MzUyN30.y90odNDSU0zZcVGMK9C39gSFDL9NJcy5E4yBkgcFc8w",sb=window.supabase.createClient(SUPA_URL,SUPA_KEY),token,D={users:[],schedules:[],calls:[],purchases:[],payouts:[],promos:[]};
function $(x){return document.getElementById(x.replace("#",""))}
async function init(){var s=await sb.auth.getSession();if(!s.data.session){location.href="/login";return}token=s.data.session.access_token;try{var r=await fetch("/api/admin/check",{headers:{Authorization:"Bearer "+token}});var j=await r.json();if(!j.isAdmin){$("loading").style.display="none";$("accessDenied").style.display="block";return}}catch(e){$("loading").style.display="none";$("accessDenied").style.display="block";return}$("loading").style.display="none";$("app").style.display="block";$("userEmail").textContent=s.data.session.user.email;events();load()}
function events(){$("refreshBtn").onclick=load;$("userSearch").onkeyup=filter;$("userFilter").onchange=filter;$("newPromoBtn").onclick=function(){$("promoModal").classList.add("active")};$("closeUserModal").onclick=function(){$("userModal").classList.remove("active")};$("closeCreditsModal").onclick=function(){$("creditsModal").classList.remove("active")};$("closePromoModal").onclick=function(){$("promoModal").classList.remove("active")};$("applyCredits").onclick=doCredits;$("createPromo").onclick=doPromo;["Users","Payouts","Purchases","Calls","Promos"].forEach(function(t){$("tab"+t).onclick=function(){document.querySelectorAll(".tab").forEach(function(x){x.classList.remove("active")});document.querySelectorAll(".tab-content").forEach(function(x){x.classList.remove("active")});this.classList.add("active");$(t.toLowerCase()+"Tab").classList.add("active")}})}
async function load(){var r=await fetch("/api/admin/dashboard",{headers:{Authorization:"Bearer "+token}});var d=await r.json();if(d.error){alert(d.error);return}D=d;$("statUsers").textContent=d.stats.totalUsers;$("statActive").textContent=d.stats.activeSchedules;$("statCalls").textContent=d.stats.totalCalls;$("statRevenue").textContent="$"+(d.stats.totalRevenue/100).toFixed(2);$("statPending").textContent=d.stats.pendingPayouts;$("statOwed").textContent="$"+(d.stats.affiliateOwed/100).toFixed(2);$("statTerms").textContent=d.stats.termsAgreed;$("statDisabled").textContent=d.stats.disabledUsers;renderUsers(d.users);renderPayouts(d.payouts);renderPurchases(d.purchases);renderCalls(d.calls);renderPromos(d.promos)}
function getSched(uid){for(var i=0;i<D.schedules.length;i++)if(D.schedules[i].user_id===uid)return D.schedules[i];return null}
function getCalls(uid){return D.calls.filter(function(c){return c.user_id===uid})}
function getPurchases(uid){return D.purchases.filter(function(p){return p.user_id===uid})}
function getSpent(uid){var t=0;getPurchases(uid).forEach(function(p){t+=p.amount_cents||0});return t}
function renderUsers(users){var h="";users.forEach(function(u){var sc=getSched(u.id),calls=getCalls(u.id).length,spent=getSpent(u.id);var schedH=sc?(sc.enabled?"<span class='badge yes'>"+(sc.hour!==undefined?sc.hour:(sc.hour!==undefined?sc.hour:0))+":"+(sc.minute!==undefined?String(sc.minute).padStart(2,"0"):(sc.minute!==undefined?String(sc.minute).padStart(2,"0"):"00"))+"</span>":"<span class='badge no'>Off</span>"):"<span class='text-muted'>None</span>";var statH=u.is_disabled?"<span class='badge disabled'>Disabled</span>":"<span class='badge active'>Active</span>";if(u.is_admin)statH+=" <span class='badge admin'>Admin</span>";var termH=u.terms_accepted_at?"<span class='badge yes'>Yes</span>":"<span class='badge no'>No</span>";var lastH=u.last_login?ago(u.last_login):"Never";h+="<tr class='clickable' data-id='"+u.id+"'><td>"+esc(u.email)+"</td><td>"+(u.credits||0)+"</td><td>"+schedH+"</td><td>"+calls+"</td><td class='text-green'>$"+(spent/100).toFixed(2)+"</td><td>"+termH+"</td><td>"+statH+"</td><td>"+lastH+"</td></tr>"});$("usersTable").innerHTML=h||"<tr><td colspan=8 class='text-muted'>No users</td></tr>";document.querySelectorAll("#usersTable tr.clickable").forEach(function(r){r.onclick=function(){showUser(this.dataset.id)}})}
function filter(){var s=$("userSearch").value.toLowerCase(),f=$("userFilter").value;var fil=D.users.filter(function(u){if(u.email.toLowerCase().indexOf(s)<0)return false;if(f==="active"&&u.is_disabled)return false;if(f==="disabled"&&!u.is_disabled)return false;if(f==="admin"&&!u.is_admin)return false;if(f==="scheduled"&&!getSched(u.id))return false;return true});renderUsers(fil)}
function showUser(uid){var u=D.users.find(function(x){return x.id===uid});if(!u)return;var sc=getSched(uid),calls=getCalls(uid),purch=getPurchases(uid),spent=getSpent(uid);$("userModalTitle").textContent=u.email;var h="<div style='display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap'><button class='btn btn-primary' onclick=\"openCredits('"+u.id+"','"+esc(u.email)+"',"+(u.credits||0)+")\">Credits</button>";h+=u.is_admin?"<button class='btn btn-warning' onclick=\"setAdmin('"+u.id+"',false)\">-Admin</button>":"<button class='btn btn-purple' onclick=\"setAdmin('"+u.id+"',true)\">+Admin</button>";h+=u.is_disabled?"<button class='btn btn-success' onclick=\"setDisable('"+u.id+"',false)\">Enable</button>":"<button class='btn btn-danger' onclick=\"setDisable('"+u.id+"',true)\">Disable</button>";h+="</div>";h+="<div class='section-title'>Account</div><div class='detail-grid'>";h+="<div class='detail-item'><div class='detail-label'>ID</div><div class='detail-value mono' style='font-size:0.65rem'>"+u.id+"</div></div>";h+="<div class='detail-item'><div class='detail-label'>Credits</div><div class='detail-value text-cyan'>"+(u.credits||0)+"</div></div>";h+="<div class='detail-item'><div class='detail-label'>Spent</div><div class='detail-value text-green'>$"+(spent/100).toFixed(2)+"</div></div>";h+="<div class='detail-item'><div class='detail-label'>Terms</div><div class='detail-value'>"+(u.terms_accepted_at?"<span class='badge yes'>Yes</span>":"<span class='badge no'>No</span>")+"</div></div>";h+="<div class='detail-item'><div class='detail-label'>Created</div><div class='detail-value'>"+(u.created_at?new Date(u.created_at).toLocaleDateString():"?")+"</div></div>";h+="<div class='detail-item'><div class='detail-label'>Last Login</div><div class='detail-value'>"+(u.last_login?new Date(u.last_login).toLocaleString():"Never")+"</div></div>";h+="<div class='detail-item'><div class='detail-label'>Ref Code</div><div class='detail-value mono text-cyan'>"+(u.referral_code||"None")+"</div></div>";h+="<div class='detail-item'><div class='detail-label'>Affiliate $</div><div class='detail-value text-orange'>$"+((u.affiliate_balance_cents||0)/100).toFixed(2)+"</div></div></div>";h+="<div class='section-title'>Schedule</div>";if(sc){h+="<div class='detail-grid'><div class='detail-item'><div class='detail-label'>Status</div><div class='detail-value'>"+(sc.enabled?"<span class='badge yes'>On</span>":"<span class='badge no'>Off</span>")+"</div></div>";h+="<div class='detail-item'><div class='detail-label'>Time</div><div class='detail-value text-cyan'>"+(sc.hour!==undefined?sc.hour:(sc.hour!==undefined?sc.hour:0))+":"+(sc.minute!==undefined?String(sc.minute).padStart(2,"0"):(sc.minute!==undefined?String(sc.minute).padStart(2,"0"):"00"))+"</div></div>";h+="<div class='detail-item'><div class='detail-label'>TZ</div><div class='detail-value'>"+(sc.timezone||"America/Chicago")+"</div></div>";h+="<div class='detail-item'><div class='detail-label'>Phone</div><div class='detail-value mono'>"+(sc.phone_number||"-")+"</div></div>";h+="<div class='detail-item'><div class='detail-label'>PIN</div><div class='detail-value mono'>"+(sc.pin||"-")+"</div></div></div>"}else{h+="<p class='text-muted'>No schedule</p>"}h+="<div class='section-title'>Calls ("+calls.length+")</div>";if(calls.length){h+="<div style='max-height:150px;overflow-y:auto'><table><thead><tr><th>Date</th><th>Result</th></tr></thead><tbody>";calls.slice(0,30).forEach(function(c){var b=c.result==="NO_TEST"?"active":c.result==="MUST_TEST"?"disabled":"pending";h+="<tr><td>"+new Date(c.created_at).toLocaleString()+"</td><td><span class='badge "+b+"'>"+c.result+"</span></td></tr>"});h+="</tbody></table></div>"}else{h+="<p class='text-muted'>No calls</p>"}h+="<div class='section-title'>Purchases ("+purch.length+")</div>";if(purch.length){h+="<table><thead><tr><th>Date</th><th>Package</th><th>Amount</th></tr></thead><tbody>";purch.forEach(function(p){h+="<tr><td>"+new Date(p.created_at).toLocaleDateString()+"</td><td>"+p.package_name+"</td><td class='text-green'>$"+(p.amount_cents/100).toFixed(2)+"</td></tr>"});h+="</tbody></table>"}else{h+="<p class='text-muted'>No purchases</p>"}$("userModalContent").innerHTML=h;$("userModal").classList.add("active")}
function renderPayouts(payouts){var pend=payouts.filter(function(p){return p.status==="pending"});var h="";if(!pend.length){h="<p class='text-muted'>No pending payouts</p>"}else{pend.forEach(function(p){h+="<div class='payout-card'><div class='payout-amount'>$"+(p.amount_cents/100).toFixed(2)+" <span class='badge pending'>Pending</span></div><div style='color:#8892b0;margin:10px 0'>User: "+(p.user_email||"?")+" | PayPal: "+p.payout_email+"</div><div style='display:flex;gap:10px'><button class='btn btn-success' onclick=\"doPayout('"+p.id+"','paid')\">Paid</button><button class='btn btn-danger' onclick=\"doPayout('"+p.id+"','rejected')\">Reject</button></div></div>"})}$("pendingPayouts").innerHTML=h}
function renderPurchases(purchases){var h="";purchases.forEach(function(p){h+="<tr><td>"+(p.user_email||"?")+"</td><td>"+p.package_name+"</td><td class='text-green'>$"+(p.amount_cents/100).toFixed(2)+"</td><td>"+new Date(p.created_at).toLocaleDateString()+"</td></tr>"});$("purchasesTable").innerHTML=h||"<tr><td colspan=4 class='text-muted'>No purchases</td></tr>"}
function renderCalls(calls){var h="";calls.slice(0,100).forEach(function(c){var b=c.result==="NO_TEST"?"active":c.result==="MUST_TEST"?"disabled":"pending";h+="<tr><td>"+(c.user_email||"?")+"</td><td><span class='badge "+b+"'>"+c.result+"</span></td><td>"+new Date(c.created_at).toLocaleString()+"</td></tr>"});$("callsTable").innerHTML=h||"<tr><td colspan=3 class='text-muted'>No calls</td></tr>"}
function renderPromos(promos){var h="";promos.forEach(function(p){h+="<tr><td class='mono text-cyan' style='font-weight:700'>"+p.code+"</td><td>"+p.credits+"</td><td>"+p.times_used+"/"+p.max_uses+"</td><td><button class='btn btn-sm btn-danger' onclick=\"delPromo('"+p.id+"')\">Del</button></td></tr>"});$("promosTable").innerHTML=h||"<tr><td colspan=4 class='text-muted'>No promos</td></tr>"}
window.openCredits=function(uid,email,cur){$("creditsUid").value=uid;$("creditsEmail").textContent=email;$("creditsCurrent").textContent=cur;$("creditsAmount").value=10;$("userModal").classList.remove("active");$("creditsModal").classList.add("active")};
function doCredits(){var uid=$("creditsUid").value,act=$("creditsAction").value,amt=parseInt($("creditsAmount").value)||0;fetch("/api/admin/user/"+uid+"/credits",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+token},body:JSON.stringify({action:act,amount:amt})}).then(function(){$("creditsModal").classList.remove("active");load();alert("Done!")})}
window.setAdmin=function(uid,v){if(!confirm(v?"Make admin?":"Remove admin?"))return;fetch("/api/admin/user/"+uid+"/admin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+token},body:JSON.stringify({isAdmin:v})}).then(function(){$("userModal").classList.remove("active");load()})};
window.setDisable=function(uid,v){if(!confirm(v?"Disable?":"Enable?"))return;fetch("/api/admin/user/"+uid+"/disable",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+token},body:JSON.stringify({disabled:v})}).then(function(){$("userModal").classList.remove("active");load()})};
window.doPayout=function(pid,st){if(!confirm("Mark "+st+"?"))return;fetch("/api/admin/payout/"+pid,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+token},body:JSON.stringify({status:st})}).then(load)};
function doPromo(){var code=$("promoCode").value.toUpperCase().trim();if(!code){alert("Enter code");return}fetch("/api/admin/promo",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+token},body:JSON.stringify({code:code,credits:parseInt($("promoCredits").value)||5,maxUses:parseInt($("promoMax").value)||100})}).then(function(){$("promoModal").classList.remove("active");load();alert("Created!")})}
window.delPromo=function(pid){if(!confirm("Delete?")){return}fetch("/api/admin/promo/"+pid,{method:"DELETE",headers:{Authorization:"Bearer "+token}}).then(load)};
function ago(d){var s=Math.floor((Date.now()-new Date(d))/1000);if(s<60)return s+"s";if(s<3600)return Math.floor(s/60)+"m";if(s<86400)return Math.floor(s/3600)+"h";return Math.floor(s/86400)+"d"}
function esc(s){return s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}
init();
</script>
</body>
</html>
